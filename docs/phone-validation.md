# Валидация номеров телефонов

## Обзор

В нашем API реализована универсальная система валидации номеров телефонов, которая поддерживает различные форматы и не привязана к конкретным странам.

## Доступные валидаторы

### 1. `@IsPhoneNumber()` - Универсальный валидатор

Проверяет, что номер телефона содержит только цифры после удаления форматирования.

**Поддерживаемые форматы:**
- `+7 (999) 123-45-67`
- `8 (999) 123-45-67`
- `+7 999 123-45-67`
- `8 999 123-45-67`
- `+79991234567`
- `89991234567`
- `9991234567`
- `+1234567890` (международные номера)
- `+44 20 7946 0958`
- `+1-555-123-4567`

**Правила валидации:**
- Удаляет все пробелы, скобки, дефисы и плюсы
- Проверяет, что остались только цифры
- Длина от 7 до 15 цифр

### 2. `@IsDigitsOnly()` - Только цифры

Проверяет, что строка содержит только цифры без форматирования.

**Примеры:**
- ✅ `1234567890`
- ✅ `9991234567`
- ❌ `123-456-7890`
- ❌ `+1234567890`
- ❌ `123 456 7890`

### 3. `@IsPhoneNumberWithMinLength(minLength)` - С минимальной длиной

Проверяет номер телефона с заданной минимальной длиной.

**Пример:**
```typescript
@IsPhoneNumberWithMinLength(10)
phone: string;
```

## Использование в DTO

```typescript
import { IsPhoneNumber, IsDigitsOnly } from '../common/validators/phone.validator';

export class UpdateUserDto {
  @ApiProperty({ 
    example: '+7 (999) 123-45-67', 
    description: 'Номер телефона. Поддерживает форматы: +7 (999) 123-45-67, +1234567890'
  })
  @IsOptional()
  @IsString()
  @IsPhoneNumber({ message: 'Номер телефона должен быть валидным' })
  phone?: string;
}
```

## Примеры валидации

### Валидные номера:

```typescript
// Российские номера
'+7 (999) 123-45-67'  // ✅
'8 (999) 123-45-67'   // ✅
'+79991234567'        // ✅
'89991234567'         // ✅
'9991234567'          // ✅

// Международные номера
'+1234567890'         // ✅
'+44 20 7946 0958'    // ✅
'+1-555-123-4567'     // ✅
'+81 3-1234-5678'     // ✅
```

### Невалидные номера:

```typescript
'123456'              // ❌ Слишком короткий
'+12345678901234567890' // ❌ Слишком длинный
'+7 (999) ABC-45-67'  // ❌ Содержит буквы
'+7 (999) 123-45-67!' // ❌ Содержит специальные символы
'abc123def'           // ❌ Содержит буквы
```

## Преимущества универсального подхода

1. **Гибкость**: Поддерживает номера любых стран
2. **Простота**: Не требует обновления при добавлении новых стран
3. **Надежность**: Проверяет только базовые правила (цифры + длина)
4. **Удобство**: Принимает различные форматы ввода

## Тестирование

```typescript
describe('Phone Validators', () => {
  it('should validate Russian phone numbers', async () => {
    const dto = new TestPhoneDto();
    dto.phone = '+7 (999) 123-45-67';
    const errors = await validate(dto);
    expect(errors).toHaveLength(0);
  });

  it('should validate international phone numbers', async () => {
    const dto = new TestPhoneDto();
    dto.phone = '+1234567890';
    const errors = await validate(dto);
    expect(errors).toHaveLength(0);
  });
});
```

## Рекомендации по использованию

1. **Для большинства случаев** используйте `@IsPhoneNumber()`
2. **Для строгой валидации** используйте `@IsDigitsOnly()`
3. **Для специфических требований** используйте `@IsPhoneNumberWithMinLength()`
4. **Всегда добавляйте понятные сообщения об ошибках**
5. **Тестируйте валидацию** с различными форматами

## Интеграция с фронтендом

Фронтенд может отправлять номера в любом удобном формате:

```javascript
// Все эти варианты будут приняты
const phoneNumbers = [
  '+7 (999) 123-45-67',
  '8 999 123-45-67',
  '+79991234567',
  '89991234567',
  '+1234567890'
];

// API автоматически их валидирует
```

## Будущие улучшения

- Добавление валидации по маске
- Поддержка расширений (добавочные номера)
- Валидация по кодам стран (опционально)
- Интеграция с библиотеками типа `libphonenumber-js`
